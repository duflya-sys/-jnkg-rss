name: 晋能控股招标数据自动抓取

on:
  schedule:
    # 每周三和周五的18:00（UTC时间，对应北京时间周四/周六2:00）
    # 调整为北京时间：每周三和周五18:00 = UTC时间10:00
    - cron: '0 10 * * 3,5'  # 每周三和周五的10:00 UTC
  workflow_dispatch:  # 允许手动触发
    inputs:
      days_limit:
        description: '抓取天数限制'
        required: false
        default: '10'
        type: string

jobs:
  crawl-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v3
    
    - name: 设置Python环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: 安装依赖
      run: |
        pip install -r requirements.txt
    
    - name: 运行数据抓取任务
      env:
        FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
        FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
        FEISHU_APP_TOKEN: ${{ secrets.FEISHU_APP_TOKEN }}
        FEISHU_TABLE_ID: ${{ secrets.FEISHU_TABLE_ID }}
        FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
      run: |
        python main.py
    
    - name: 上传抓取日志
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: crawl-logs
        path: |
          *.log
          *.csv
        retention-days: 7